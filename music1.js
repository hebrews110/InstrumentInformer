
var instruments = [
    [ "Strings",
        "A string instrument is a musical instrument that makes sound by vibrating the strings on it. The strings are plucked to produce sounds. Each string has a different frequency. The desired frequency can be obtained by adjusting the tension on the string. A string instrument plays soft notes. The strings on the instrument usually come in many shapes and forms. There are many types of stringed instruments. The most common of these appear in the violin family. The violin is a small, stringed instrument played with a bow- which is usually made of horses hair. When the bow is drawn across the strings it creates a vibration. You can select what vibration the bow makes by choosing the note on the fingerboard. It is tuned to G, D, A and E. The viola is a very similar instrument aside from some small differences - it is slightly larger, and is tuned to C, G, D, and A.The cello is a stringed instrument that is played in the bass clef. It is much bigger than the violin, and is also played much differently. The double-bass is bigger still and is the lowest of them all.<p></p>There are also plucked strings, the most famous of which would probably be the guitar. The guitar uses a fret board and a pick to pluck the strings while holding down on the fret board. It was made famous by rock groups like Led Zeppelin and artists like Eric Clapton. You play by strumming with one hand while choosing notes on the fret-board (string board) with the other. Banjos are also very similar." +
        "<p></p><center>" +
        "<button class='btn btn-dark'>Violin</button>" +
        "<button class='btn btn-dark'>Viola</button>" +
        "<button class='btn btn-dark'>Cello</button>" +
        "<button class='btn btn-dark'>Double bass</button>" +
        "<button class='btn btn-dark'>Harp</button>" +
        "</center>"
    ],
    [ "harp",
        "The harp is a musical instrument. It is the second biggest string instrument " +
        "in an orchestra. It dates back to 4000 BC when the Egyptians used them in holy places. " +
        "<p></p>" +
        "Harp players pluck the strings with their fingers, similar to a guitar. " + 
        "This makes the strings move so that the strings make sounds. " +
        "Each string sound is a different musical note. Harp players play music " +
        "by plucking the strings in the right order and at the right time. More " +
        "than one string can be plucked at the same time to make a chord, or they " +
        "can be played quickly, one after another, to make an arpeggio. When the " +
        "harp player wants a note to stop, they touch that string softly, so that it stops moving.", "harp.png"],
    [ "violin", "The violin is a string instrument which has four strings and is played with a bow. The strings are usually tuned to the notes G, D, A, and E. It is held between the left collar bone (near the shoulder) and the chin. Different notes are made by fingering (pressing on the strings) with the left hand while bowing with the right. It has no frets or other markers.<p></p>The violin is the smallest and highest pitched string instrument typically used in western music. A person who plays the violin is called a violinist.", "violin.svg", "violin.wav"],
    [ "viola", "A viola (pronounced vee-Oh-la) is a musical instrument which is similar to the violin and cello. The viola sounds lower than a violin, but higher than a cello. It has four strings, called the C, G, D, and A strings. The highest string is the A. The viola is played with a bow in the right hand. Playing with the bow is called arco.<p></p>When people see the viola, sometimes they think it is a violin. This is because the viola is only a little larger than a violin, and like the violin, the viola is held on the player's left shoulder. It is also because the sound of the viola is only five notes lower than the sound of the violin. The biggest difference between the viola and the violin is the different sound. The viola's lowest string is the 'C' string and its highest string is the 'A' string. So, to see whether a violin-like instrument is a violin or viola, one will need to pluck the thinnest string. The violin's lowest string is the 'G' string and its highest string is the 'E' string. Even though the viola and violin can play many of the same notes, they each have a special sound quality. Sometimes people describe the viola's sound as more 'dark', 'earthy', or 'mellow' than the violin's sound.", "viola.png", "viola.wav"],
    [ "cello", "The cello is an instrument used to play music. Its name comes from the Italian language, so it is pronounced “chello”. The full word is violoncello, but when speaking, people normally call it the “cello”.  It has many uses: as a solo instrument, in chamber music and also in orchestras. It is also occasionally used by pop musicians.<p></p>The parts of the cello are similar to those of the violin. The strings are tuned to C-G-D-A, (low to high). The cello has a deep, rich sound. It starts two octaves below middle C, but can go very high.", "cello.svg"],
    [ "double bass", "The double bass is a large stringed instrument.  It plays low-pitched musical notes in musical ensembles and bands. In jazz bands, these low-pitched musical notes are called the 'bass line'. The double bass looks like smaller instruments like the violin, viola, and cello.<p></p>In an orchestra, double bass players bow the strings with a wooden bow strung with horsehair, or pluck the strings with their fingers (plucking the strings is called pizzicato). In jazz the double bass is played pizzicato most of the time. However some jazz players use the bow to play melodies on the double bass.<p></p>Fun fact: the double bass is generally tuned in fourths, in contrast to members of the orchestral string family, which are tuned in fifths.", "double_bass.svg", "double_bass.mp3" ],
    [ "Woodwinds",
        "Woodwind instruments are a family of musical instruments within the more general category of wind instruments. Common examples include flute, oboe, clarinet, bassoon, and saxophone. There are two main types of woodwind instruments: flutes and reed instruments (otherwise called reed pipes).<p></p>What differentiates these instruments from other wind instruments is the way in which they produce their sound. All woodwinds produce sound by splitting an exhaled air stream on a sharp edge, such as a reed or a fipple. A woodwind may be made of any material, not just wood. Common examples include brass, silver, and cane, as well as other metals such as gold and platinum. Occasionally woodwinds are made out of earthen materials, especially ocarinas." +
        "<p></p><center>" +
        "<button class='btn btn-dark'>Flute</button>" +
        "<button class='btn btn-dark'>Oboe</button>" +
        "<button class='btn btn-dark'>Clarinet</button>" +
        "<button class='btn btn-dark'>Bassoon</button>"
    ],
    [ "flute", "The flute is a woodwind instrument, but modern flutes are made of metal. It was made of wood a long time ago. It doesn't need lip vibration like brass instruments. Flute players hold it horizontally and make a sound by blowing their breath over the edge of the hole of flute's head. This makes the air vibrate. Flutes need the second most amount of air for an instrument, next to the tuba.", "flute.png", "flute.wav"],
    [ "oboe", "An oboe is a woodwind instrument with a double reed. It looks very similar to the clarinet, and may be confused with it. While the clarinet's shape remains cylindrical, the oboe's body is conical. The sounds produced by clarinets and oboes are very different. An oboe's sound is produced by blowing air through the double reed at the upper end of the instrument which forces the two reeds to vibrate together which produces the sound. The oboe has four parts: the bell, lower joint, upper joint, and the reed. A person that plays the oboe is called an oboist. A typical orchestra may have two oboes but sometimes three.", "oboe.svg", "oboe.wav"],
    [ "clarinet", "The clarinet is a woodwind instrument. The holes are covered by the fingers to make musical notes. There are also buttons pressed by the fingers which allow pads over holes to open or close so all notes of the chromatic scale can be played. The buttons are usually played with the 'pinkie' finger.", "clarinet.svg", "clarinet.wav"],
    [ "bassoon", "The bassoon is the lowest of the four main instrument of the woodwind family. Like the oboe, it has a double reed. The reed is attached to a curved metal mouthpiece which is joined to the main parts of the instrument. These are two parts called ‘bass joint’ and ‘wing joint’ (or ‘tenor joint’). They are joined at the bottom by a U-shaped piece called the ‘boot’. The instrument is quite heavy. Some players have a neckstrap around their neck to support the weight, but usually they use a seat strap that connects at the bottom of the boot and goes across the floor. ", "bassoon.png", "bassoon.wav"],
    [ "Brass", 
        "A brass instrument is a musical instrument that you play by blowing through a mouthpiece to change the pitch, or note.<p></p>With brass instruments, the sound starts at the lips. Their mouthpieces just help your lips buzz. It does not matter if the instrument is really made of brass, as long as it works that way.<p></p>It is not important what the instrument is made of. Some brass instruments are really made of wood, but are still called brass instruments, like the serpent. Other instruments are made of brass but do not work like this, like the saxophone. They are not called brass instruments, because they don't work the way other brass instruments do.<p></p>There are also parts of the instrument that change the resonance and thus the pitch, like slides or valves." +
        "<p></p><center>" +
        "<button class='btn btn-dark'>French horn</button>" +
        "<button class='btn btn-dark'>Trumpet</button>" +
        "<button class='btn btn-dark'>Trombone</button>" +
        "<button class='btn btn-dark'>Tuba</button>"
    ],
    [ "french horn", "The French horn is descended from a hunting horn that came into existence in France during the second half of the 17th century.<p></p>The French horn is easy to spot because of its circular shape. It's a long slender metal tube, about 17 feet long, curved around and around, with a large bell at the end.", "french_horn.svg", "french_horn.wav"],
    [ "trumpet", "A trumpet is a brass instrument used mainly in Classical music and jazz music. The most common type of trumpet is a B♭ trumpet, meaning that if the player plays a C, it will sound like a B♭ in concert pitch. The trumpet is played by blowing into the mouthpiece and making a 'buzzing' sound. There are three keys called valves that the player can press to change the pitch.<p></p>Classical music is written for solo trumpet, and trumpets are included in orchestras. Trumpets play an important part in Jazz music, and other various popular genres. Sometimes, they also play short parts to emphasize sections in rock songs.", "trumpet.svg", "trumpet.wav"],
    [ "trombone", "The trombone is a brass horn musical instrument. It is similar to a large trumpet, except the player pushes and pulls on slide to change the length of the tube.<p></p>Together with vibrations from the player's lips, the trombone can play a wide range of notes. It sounds deeper than a trumpet and is usually said to be one of the bass clef instruments. Music is normally written in the bass clef, but some high parts can be written in tenor clef. Some players have the music transposed into the treble clef.<p></p>Fun fact: trombones are nearly always made out of brass but can also be made out of plastic: the 'P-bone'.", "trombone.svg", "trombone.wav"],
    [ "tuba", "The tuba is the biggest of all the brass musical instruments. They are the newest part of the symphony orchestra, first showing up in the mid-19th century. Most orchestras have a tuba now. The standard tuba has about 16 feet of tubes.<p></p>The tuba usually plays the bass (lowest sounding) part even though it can play relatively high as well.<p></p>The tuba is used in all sorts of music and can be found in orchestras, wind bands, brass bands, jazz groups, pop groups, brass ensembles and even in tuba quartets (in groups of 4).", "tuba.png", "tuba.wav"],
    [ "Percussion",
        "Percussion instruments are instruments which are played by shaking or hitting. There are many different kinds of percussion instruments. A person who plays a percussion instrument is a percussionist. Percussionists are usually able to play lots of different percussion instruments, because the basic skills required are similar.<p></p>Some percussion instruments can play tunes. These are called “tuned percussion”. Tuned percussion instruments include: xylophone, glockenspiel, vibraphone, tubular bells and timpani.<p></p>Whenever any unusual instrument is used that does not fit into the category of string, woodwind, brass or keyboard, it is usually played by a percussionist. Sometimes composers have used things like typewriters, milk bottles or vacuum cleaners in their pieces." +
        "<p></p><center>" +
        "<button class='btn btn-dark'>Snare drum</button>" +
        "<button class='btn btn-dark'>Cymbals</button>" +
        "<button class='btn btn-dark'>Bass drum</button>" +
        "<button class='btn btn-dark'>Piano</button>"
    ],
    [ "snare drum", "The snare drum or side drum is a percussion instrument. It has strands of snares made of curled metal wire, metal cable, plastic cable, or gut cords. They are stretched across the skin on the bottom of the drum. Pipe and tabor and some military snare drums can have a second set of snares on the bottom side of the top head. This is used to make a 'brighter' sound. The snare drum is considered one of the most important drums of the drum kit.", "snare_drum.png", "snare_drum.wav"],
    [ "cymbals", "Cymbals (pronounced like the word “symbol”) are percussion instruments. They are discs made of copper, bronze or a special alloy. They look rather like saucepan lids, but in the middle they jut out a little and they have straps there that pass through a hole.<p></p>There are two ways of playing cymbals. One way is to use a pair of cymbals that are the same. The player holds one cymbal in each hand, holding them by the strap. He then bangs the cymbals together. There are many ways of doing this depending on the sort of sound that is wanted. For example, a very quiet sound can be made by rubbing the edges of the cymbals together. A very loud sound can be made by hitting them together as the arms form a circle, and letting the cymbals vibrate for a long time by holding them in the air.", "cymbals.png", "cymbals.wav"],
    [ "bass drum", "A bass drum, or kick drum, is a large drum that produces a note of low definite or indefinite pitch. A bass drum is typically cylindrical, with the drum's diameter much greater than the drum's depth.  Bass drums are built in a variety of sizes, but size has little to do with the volume produced by the drum, and more to do with convenience and aesthetics.<p></p>In many forms of music, the bass drum is used to mark or keep time. The bass drum makes a low, boom sound when the mallet hits the drumhead. In marches, it is used to project tempo (marching bands historically march to the beat of the bass). A basic beat for rock and roll has the bass drum played on the first and third beats of bars in common time, with the snare drum on the second and fourth beats, called backbeats. In jazz, the bass drum can vary from almost entirely being a timekeeping medium to being a melodic voice in conjunction with the other parts of the set.", "bass_drum.png", "bass_drum.wav"],
    [ "piano", "A piano (also called a pianoforte) is a musical instrument classified as a percussion instrument. A person who plays the piano is called a pianist. Pianos are played by pressing keys on a keyboard.<p></p>When a key is pressed down, the damper comes off the string and a hammer hits the string. It hits it very quickly and bounces off so that the string is free to vibrate and make a sound.<p></p>Although an acoustic piano has strings, it is usually classified as a percussion instrument rather than as a stringed instrument, because the strings are struck rather than plucked.", "piano.svg", "piano.wav"]
];

var currentInstrument = -1;

var previousInstrument;

var pageOpened = false;


(function($){
     $.fn.extend({
          center: function (options) {
               var options =  $.extend({ // Default values
                    inside:window, // element, center into window
                    transition: 0, // millisecond, transition time
                    minX:0, // pixel, minimum left element value
                    minY:0, // pixel, minimum top element value
                    withScrolling:true, // booleen, take care of the scrollbar (scrollTop)
                    vertical:true, // booleen, center vertical
                    horizontal:true, // booleen, center horizontal
                    complete:function() { }
               }, options);
               return this.each(function() {
                    var props = {position:'absolute'};
                    if (options.vertical) {
                         var top = ($(options.inside).height() - $(this).outerHeight()) / 2;
                         if (options.withScrolling) top += $(options.inside).scrollTop() || 0;
                         top = (top > options.minY ? top : options.minY);
                         $.extend(props, {top: top+'px'});
                    }
                    if (options.horizontal) {
                          var left = ($(options.inside).width() - $(this).outerWidth()) / 2;
                          if (options.withScrolling) left += $(options.inside).scrollLeft() || 0;
                          left = (left > options.minX ? left : options.minX);
                          $.extend(props, {left: left+'px'});
                    }
                    if (options.transition > 0) $(this).animate(props, { duration: options.transition, complete: options.complete });
                    else $(this).css(props);
                    return $(this);
               });
          }
     });
})(jQuery);


function instrument_btn_click_handler() {
    var $btn = $(this);
    
    var instr = $btn.attr("data-instrument");
    if(instr === undefined)
        instr = $btn.text().toLowerCase();
    var instr_num = -1;
    for(var i = 0; i < instruments.length; i++) {
        if(instruments[i] === undefined)
        {
            throw "Instrument at index " + i + " has undefined name";
        }
        if(instruments[i][0].toLowerCase() === instr) {
            instr_num = i;
            break;
        }
    }
    if(instr_num === -1)
        instr_num = parseInt(instr);
    if(instr_num === -1 || isNaN(instr_num) || instr_num === null || instr_num === undefined)
        throw "Unknown instrument";
    $btn.prop("disabled", "disabled");
    
    $(".families").animate({
        left: $(window).width() * 2
    }, {
        duration: 500,
        complete: function() {
            $(".families").addClass("invisible");
            setInstrument(instr_num, function() {
                $btn.removeProp("disabled");
            });
        }
    });  
}
function goBack() {
    setInstrument(previousInstrument);
    previousInstrument = -1; /* return to main screen */
}
function setInstrument(i, cb) {
    
    if(i === -1) {
        /* return to main screen */
        $(".instrument-viewer").animate({
            left: -$(window).width() * 2
        }, {
            duration: 500,
            complete: function() {
                $(".instrument-viewer").addClass("invisible");
                $(".families").center({
                    horizontal: false,
                    transition: 0
                });
                $(".families").removeClass("invisible");
                $(".families").center({
                    transition: 500,
                    vertical: false,
                    complete: function() {
                        if(cb !== undefined)
                            cb();
                    }
                });
            }
        });
        return;
    }
    
    if(i === undefined || i === null || isNaN(i))
        throw "Unknown instrument: " + i;
    if(i >= instruments.length || i < 0)
        throw "Out-of-range instrument: " + i;
    
    
    var complete = function() {
           $(".instrument-heading").text(instruments[i][0][0].toUpperCase() + instruments[i][0].substr(1));
            $(".instrument-image").show();
            $(".instrument-info").html(instruments[i][1]);
            $(".instrument-info button").click(instrument_btn_click_handler);
            
            var loaded = function() {
                /*
                 * Remove all event handlers to prevent the possibility of
                 * entering this twice.
                 */
                $(".instrument-image").off("load", loaded);
                $(".instrument-image").off("error", loaded);
                $(".instrument-viewer").center({
                    horizontal: false,
                    transition: 0
                });
                $(".instrument-viewer").center({
                    transition: 500,
                    vertical: false,
                    complete: function() {
                        if(cb !== undefined)
                            cb();
                    }
                });
            };
            
            if(instruments[i][2] !== undefined) {
                $(".instrument-image").attr("src", instruments[i][2]);
                $(".instrument-image").one("load", loaded);
                $(".instrument-image").one("error", loaded);
            } else
                $(".instrument-image").hide();
            $(".instrument-audio").hide();
            
            var mp3name;
            
            if(instruments[i][3] === undefined)
                mp3name = instruments[i][0] + ".mp3";
            else
                mp3name = instruments[i][3];
            $(".instrument-audio").attr("src", mp3name + "?randomQuery=" + new Date().getTime());
            
            currentInstrument = i;
            $(".instrument-viewer").removeClass("invisible");
            if(!pageOpened) {
                
                pageOpened = true;
            }
            
            if(instruments[i][2] === undefined)
                loaded();
                
    };
    
    
    previousInstrument = currentInstrument;
    
    
    $(".instrument-viewer").animate({
        left: -$(window).width()
    }, {
        duration: 500,
        complete: complete
    });
}

$(window).resize(function() {
    $(".screen-container > div").center();
});
$(window).load(function() {
    console.log("Starting");
    
    $(".screen-container > div").center();
    $(".instrument-audio").on("canplay", function() {
        $(this).show();
    });
    $(".instrument-audio").on("error", function() {
        $(this).hide(); 
    });
    $(".instrument-image").on("error", function() {
        $(this).hide();
    });
    $(".instrument-btn").click(instrument_btn_click_handler);
    $(".families").removeClass("invisible");
});